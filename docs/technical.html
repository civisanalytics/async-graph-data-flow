<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="More Examples" href="more_examples.html" /><link rel="prev" title="Quickstart" href="quickstart.html" />

    <!-- Generated with Sphinx 7.2.6 and Furo 2023.09.10 -->
        <title>Technical Notes - async-graph-data-flow documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">async-graph-data-flow  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">async-graph-data-flow  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Technical Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="more_examples.html">More Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="technical-notes">
<span id="technical"></span><h1>Technical Notes<a class="headerlink" href="#technical-notes" title="Link to this heading">#</a></h1>
<section id="functions-arranged-as-a-graph">
<h2>Functions Arranged as a Graph<a class="headerlink" href="#functions-arranged-as-a-graph" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">async-graph-data-flow</span></code> package provides a framework for arranging
functions in a directed acyclic graph (DAG).</p>
<div class="mermaid">
            flowchart LR

A[func1] --&gt; B[func2]
B --&gt; C[func3]
B --&gt; D[func4]
C --&gt; E[func5]
D --&gt; E
        </div><p>Each function must be an asynchronous generator function,
which means it is defined with the <code class="docutils literal notranslate"><span class="pre">async</span></code> keyword
and yields something.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">func1</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">yield</span> <span class="n">output</span>
</pre></div>
</div>
<p>For two nodes to be connected correctly in terms of function definition,
the source node’s function must yield what the destination node’s function
expects as input
(for more information,
see the <code class="docutils literal notranslate"><span class="pre">unpack_input</span></code> parameter of <a class="reference internal" href="api.html#async_graph_data_flow.AsyncGraph.add_node" title="async_graph_data_flow.AsyncGraph.add_node"><code class="xref py py-func docutils literal notranslate"><span class="pre">add_node()</span></code></a>).</p>
<div class="mermaid">
            flowchart LR

START[ ] -.-&gt; A
B -.-&gt; STOP[ ]
A[&quot;async def func2(...):\n&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;...\n&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;yield &lt;strong&gt;foo, bar&lt;/strong&gt;&quot;] --&gt; B[&quot;async def func3(&lt;strong&gt;foo, bar&lt;/strong&gt;):\n&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;...\n&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;yield ...&quot;]
style A text-align:left
style B text-align:left
style START fill-opacity:0, stroke-opacity:0;
style STOP  fill-opacity:0, stroke-opacity:0;
        </div></section>
<section id="tasks-and-queues">
<h2>Tasks and Queues<a class="headerlink" href="#tasks-and-queues" title="Link to this heading">#</a></h2>
<p>During runtime, each node’s function is run concurrently
as one or more <a class="reference external" href="https://docs.python.org/3/library/asyncio-task.html#asyncio.Task" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tasks</span></code></a> in the event loop.
The number of tasks for a given node is controlled by
the <code class="docutils literal notranslate"><span class="pre">max_tasks</span></code> parameter that can be set at <a class="reference internal" href="api.html#async_graph_data_flow.AsyncGraph.add_node" title="async_graph_data_flow.AsyncGraph.add_node"><code class="xref py py-func docutils literal notranslate"><span class="pre">add_node()</span></code></a>.</p>
<p>A node is associated with a <a class="reference external" href="https://docs.python.org/3/library/asyncio-queue.html#asyncio.Queue" title="(in Python v3.12)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Queue</span></code></a> instance
responsible for providing the items to the tasks of the node.
The queue receives its items as the source nodes yield them.
The maximum number of items a queue can hold is specified by <code class="docutils literal notranslate"><span class="pre">queue_size</span></code>
at <a class="reference internal" href="api.html#async_graph_data_flow.AsyncGraph.add_node" title="async_graph_data_flow.AsyncGraph.add_node"><code class="xref py py-func docutils literal notranslate"><span class="pre">add_node()</span></code></a>.
The queue is first-in-first-out, which means that
it keeps track of the items yielded from the tasks of the source nodes
and feeds them one by one in the order by which the queue has received them.
An item leaves a queue when a task of the destination node becomes
available to process it.</p>
<div class="mermaid">
            flowchart LR

start1[ ] -.- queue1((&quot;&amp;nbsp;&amp;nbsp;&quot;))
subgraph box1 [ ]
    queue1 --&gt; node1[&quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot;]
end
style start1 fill-opacity:0, stroke-opacity:0;

start2[ ] -.- queue2((&quot;&amp;nbsp;&amp;nbsp;&quot;))
subgraph box2 [ ]
    queue2 --&gt; node2[&quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot;]
end
style start2 fill-opacity:0, stroke-opacity:0;

subgraph node and its associated queue
    queue3((queue)) --&gt; node3[task 1, task 2,\ntask 3, ...]
end

node1 --&gt; |yields\nitems| queue3
node2 --&gt; |yields\nitems| queue3
node3 -.-&gt; |yields\nitems| STOP[ ]
style STOP  fill-opacity:0, stroke-opacity:0;
        </div></section>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Link to this heading">#</a></h2>
<p>Let’s check out a sample script using async-graph-data-flow and processing actual data
that brings together some of the components discussed above.
The example below pulls data from <a class="reference external" href="https://www.openbrewerydb.org/">Open Brewery DB</a>
into a local CSV file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># This Python script was tested with Python 3.11.</span>
<span class="c1"># Apart from async-graph-data-flow, it requires several other third-party dependencies,</span>
<span class="c1"># which can be installed by `pip install aiocsv aiofile aiohttp`.</span>

<span class="kn">import</span> <span class="nn">aiocsv</span>
<span class="kn">import</span> <span class="nn">aiofile</span>
<span class="kn">import</span> <span class="nn">aiohttp</span>
<span class="kn">from</span> <span class="nn">async_graph_data_flow</span> <span class="kn">import</span> <span class="n">AsyncGraph</span><span class="p">,</span> <span class="n">AsyncExecutor</span>

<span class="c1"># API doc: https://www.openbrewerydb.org/documentation</span>
<span class="n">URL</span> <span class="o">=</span> <span class="s2">&quot;https://api.openbrewerydb.org/v1/breweries&quot;</span>
<span class="n">CSV_HEADER</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;id&quot;</span><span class="p">,</span>
    <span class="s2">&quot;name&quot;</span><span class="p">,</span>
    <span class="s2">&quot;brewery_type&quot;</span><span class="p">,</span>
    <span class="s2">&quot;address_1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;address_2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;address_3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;city&quot;</span><span class="p">,</span>
    <span class="s2">&quot;state_province&quot;</span><span class="p">,</span>
    <span class="s2">&quot;postal_code&quot;</span><span class="p">,</span>
    <span class="s2">&quot;country&quot;</span><span class="p">,</span>
    <span class="s2">&quot;longitude&quot;</span><span class="p">,</span>
    <span class="s2">&quot;latitude&quot;</span><span class="p">,</span>
    <span class="s2">&quot;phone&quot;</span><span class="p">,</span>
    <span class="s2">&quot;website_url&quot;</span><span class="p">,</span>
    <span class="s2">&quot;state&quot;</span><span class="p">,</span>
    <span class="s2">&quot;street&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">OUTPUT_FILENAME</span> <span class="o">=</span> <span class="s2">&quot;breweries_us_async.csv&quot;</span>

<span class="n">has_written_csv_header</span> <span class="o">=</span> <span class="kc">False</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">get_open_brewery_data</span><span class="p">():</span>
    <span class="n">page</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;by_country&quot;</span><span class="p">:</span> <span class="s2">&quot;United States&quot;</span><span class="p">,</span>
                <span class="s2">&quot;page&quot;</span><span class="p">:</span> <span class="n">page</span><span class="p">,</span>
                <span class="s2">&quot;per_page&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">URL</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
                <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
                <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">data</span>
                    <span class="n">page</span> <span class="o">+=</span> <span class="mi">1</span>


<span class="k">async</span> <span class="k">def</span> <span class="nf">write_to_csv</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]):</span>
    <span class="k">global</span> <span class="n">has_written_csv_header</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">aiofile</span><span class="o">.</span><span class="n">async_open</span><span class="p">(</span><span class="n">OUTPUT_FILENAME</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">csv_writer</span> <span class="o">=</span> <span class="n">aiocsv</span><span class="o">.</span><span class="n">AsyncDictWriter</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">CSV_HEADER</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">has_written_csv_header</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">csv_writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
            <span class="n">has_written_csv_header</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">await</span> <span class="n">csv_writer</span><span class="o">.</span><span class="n">writerows</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">yield</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">graph</span> <span class="o">=</span> <span class="n">AsyncGraph</span><span class="p">()</span>
    <span class="n">graph</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">get_open_brewery_data</span><span class="p">)</span>
    <span class="n">graph</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">write_to_csv</span><span class="p">)</span>
    <span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">get_open_brewery_data</span><span class="p">,</span> <span class="n">write_to_csv</span><span class="p">)</span>

    <span class="n">executor</span> <span class="o">=</span> <span class="n">AsyncExecutor</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
    <span class="n">executor</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;data downloaded:&quot;</span><span class="p">,</span> <span class="n">OUTPUT_FILENAME</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>In this code, <code class="docutils literal notranslate"><span class="pre">main()</span></code> defines a graph and executes it.
The graph has two connected nodes.
The source node, with the asynchronous generator function <code class="docutils literal notranslate"><span class="pre">get_open_brewery_data()</span></code>,
yields items to the destination node with <code class="docutils literal notranslate"><span class="pre">write_to_csv()</span></code>:</p>
<div class="mermaid">
            flowchart LR

A[get_open_brewery_data] --&gt; B[write_to_csv]
        </div><p>For the source node,
the following shows an abridged version of <code class="docutils literal notranslate"><span class="pre">get_open_brewery_data()</span></code>
to highlight what the function yields:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">get_open_brewery_data</span><span class="p">():</span>
    <span class="n">page</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="o">...</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;page&quot;</span><span class="p">:</span> <span class="n">page</span><span class="p">,</span> <span class="o">...</span><span class="p">}</span>
        <span class="o">...</span>
        <span class="k">yield</span> <span class="n">data</span>
        <span class="n">page</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
<p>As the data from Open Brewery DB is paginated from its API,
<code class="docutils literal notranslate"><span class="pre">get_open_brewery_data()</span></code> makes an API call for one page worth of data,
yields this data to the destination node (<code class="docutils literal notranslate"><span class="pre">write_to_csv()</span></code>),
repeats this process, and stops once all pages of data have been retrieved.</p>
<p>The destination node with <code class="docutils literal notranslate"><span class="pre">write_to_csv()</span></code> has its associated queue provide
inputs from the items yielded by <code class="docutils literal notranslate"><span class="pre">get_open_brewery_data()</span></code>.</p>
<div class="mermaid">
            flowchart LR

Q((&quot;Queue items:\n[{'col1': 'val1', ...}, ...]\n[{'col1': 'val1', ...}, ...]\n...\n&quot;))
A[get_open_brewery_data]
B[write_to_csv]
A --&gt; |yields\nitems| Q
Q --&gt; B
        </div><p><code class="docutils literal notranslate"><span class="pre">get_open_brewery_data()</span></code> yields a page of the Open Brewery DB data,
which is a list of records where each record is a dictionary of column names
mapped to values. The function signature of <code class="docutils literal notranslate"><span class="pre">write_to_csv()</span></code> expects exactly
such a list of dictionaries:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">write_to_csv</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]):</span>
    <span class="o">...</span>
</pre></div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="more_examples.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">More Examples</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="quickstart.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Quickstart</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022 - 2023, Civis Analytics. Documentation last updated on 2023-11-30.
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Technical Notes</a><ul>
<li><a class="reference internal" href="#functions-arranged-as-a-graph">Functions Arranged as a Graph</a></li>
<li><a class="reference internal" href="#tasks-and-queues">Tasks and Queues</a></li>
<li><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=32e29ea5"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="https://unpkg.com/mermaid@10.2.0/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    </body>
</html>